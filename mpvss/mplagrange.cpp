#include "mplagrange.h"

using namespace std;

static const CSC25519 MPLagrangeCoeff(uint32_t x,uint32_t y);

const MPUInt256 MPLagrange(vector<pair<uint32_t,MPUInt256> >& vShare)
{
    CSC25519 s0;
    for (size_t i = 0;i < vShare.size();i++)
    {
        CSC25519 l(1);
        for (size_t j = 0;j < vShare.size();j++)
        {
            if (i != j)
            {
                l *= MPLagrangeCoeff(vShare[i].first,vShare[j].first);
            }
        }
        s0 += l * vShare[i].second.ToSC25519();
    }
    return MPUInt256(s0);
}

static const MPUInt256 SCInverse[100] = 
{
    MPUInt256("0x0000000000000000000000000000000000000000000000000000000000000000"),
    MPUInt256("0x0000000000000000000000000000000000000000000000000000000000000001"),
    MPUInt256("0x080000000000000000000000000000000a6f7cef517bce6b2c09318d2e7ae9f7"),
    MPUInt256("0x0aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaab894a6946ca51339900c4211934e8d49"),
    MPUInt256("0x0c0000000000000000000000000000000fa73b66fa39b5a0c20dca53c5b85ef2"),
    MPUInt256("0x03333333333333333333333333333333375fcb92ed64b8f7ab36e09edf645d96"),
    MPUInt256("0x0d55555555555555555555555555555566b9d03987ce5807f40f5295f822309b"),
    MPUInt256("0x024924924924924924924924924924924c1fda8d84fecd43312732ba9f90d522"),
    MPUInt256("0x0600000000000000000000000000000007d39db37d1cdad06106e529e2dc2f79"),
    MPUInt256("0x038e38e38e38e38e38e38e38e38e38e392dc3786cee1b11330041605dbc4d9c3"),
    MPUInt256("0x019999999999999999999999999999999bafe5c976b25c7bd59b704f6fb22ecb"),
    MPUInt256("0x0e8ba2e8ba2e8ba2e8ba2e8ba2e8ba2e9e9c28f8f13e317d0a3f42d225f6c0a9"),
    MPUInt256("0x0eaaaaaaaaaaaaaaaaaaaaaaaaaaaaaabdcc650c1562fa6f2610dad82a8c0244"),
    MPUInt256("0x076276276276276276276276276276276c18248e23d4be8a50087c82524a130b"),
    MPUInt256("0x01249249249249249249249249249249260fed46c27f66a19893995d4fc86a91"),
    MPUInt256("0x0bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbcb09ea70111bfb8c1e73e246887001d0"),
    MPUInt256("0x0b0000000000000000000000000000000e594bc9100a3bd35c8ca4221fe901b3"),
    MPUInt256("0x01e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e45677bfd6eff45573c5ed8aa186552b"),
    MPUInt256("0x09c71c71c71c71c71c71c71c71c71c71d3dd98b2b8eca6f4c40b3c901c5d56d8"),
    MPUInt256("0x09435e50d79435e50d79435e50d79435f122c68e5e5975bf765b7cbe6bb6be10"),
    MPUInt256("0x08ccccccccccccccccccccccccccccccd8476fd40cd4fca916d6e9b4e654015c"),
    MPUInt256("0x061861861861861861861861861861862054f17962a778b32dbddc9c542ce305"),
    MPUInt256("0x0f45d1745d1745d1745d1745d1745d1759bd916bca1ae729b128d2f641764a4b"),
    MPUInt256("0x0642c8590b21642c8590b21642c8590b298ee7571e60e453dfae26c7888cb71a"),
    MPUInt256("0x075555555555555555555555555555555ee632860ab17d3793086d6c15460122"),
    MPUInt256("0x0a3d70a3d70a3d70a3d70a3d70a3d70a4acc25095e0f1cb223e2cec931412b79"),
    MPUInt256("0x0bb13b13b13b13b13b13b13b13b13b13c07b8f3663662db0540d6fce579ff37c"),
    MPUInt256("0x0bda12f684bda12f684bda12f684bda13ede0e6c06f04e3ff562f413873ad5df"),
    MPUInt256("0x089249249249249249249249249249249d777392b2bb81bbf852fe3bd65f1f3f"),
    MPUInt256("0x0469ee58469ee58469ee58469ee58469f41a33463e9c95324d42dd8bafb692bd"),
    MPUInt256("0x05dddddddddddddddddddddddddddddde584f538088dfdc60f39f123443800e8"),
    MPUInt256("0x04210842108421084210842108421084266b173132506a89e52e090f0fbb4f77"),
    MPUInt256("0x0d800000000000000000000000000000119c22d3d980ec54da4f839e3e6f6ad0"),
    MPUInt256("0x0f83e0f83e0f83e0f83e0f83e0f83e0f981e09921264790de8cc03024aa0cd81"),
    MPUInt256("0x08f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0fc9ab8cf3cf3c895e5ec28527f3e148c"),
    MPUInt256("0x00750750750750750750750750750750759ff882b432f5da3d07d6f21fe9c43a"),
    MPUInt256("0x04e38e38e38e38e38e38e38e38e38e38e9eecc595c76537a62059e480e2eab6c"),
    MPUInt256("0x06eb3e45306eb3e45306eb3e45306eb3ed5980cefa5d3ce711540f2dfeaf7e3d"),
    MPUInt256("0x04a1af286bca1af286bca1af286bca1af89163472f2cbadfbb2dbe5f35db5f08"),
    MPUInt256("0x0d20d20d20d20d20d20d20d20d20d20d31f20819234152bd000f163d0411e8f7"),
    MPUInt256("0x046666666666666666666666666666666c23b7ea066a7e548b6b74da732a00ae"),
    MPUInt256("0x0e0c7ce0c7ce0c7ce0c7ce0c7ce0c7ce1ed0458b4a690696bdb8baeb70d7d94d"),
    MPUInt256("0x0b0c30c30c30c30c30c30c30c30c30c31a99f5ac02cf8ac4c2e81fdb58915b79"),
    MPUInt256("0x017d05f417d05f417d05f417d05f417d07e51d327a529190f6550f2c20761f9f"),
    MPUInt256("0x0fa2e8ba2e8ba2e8ba2e8ba2e8ba2e8bb74e45a536894200049d9b084f360f1c"),
    MPUInt256("0x03e93e93e93e93e93e93e93e93e93e93ee58a37ab05ea92eb4d14b6cd82555f0"),
    MPUInt256("0x0321642c8590b21642c8590b21642c8594c773ab8f307229efd71363c4465b8d"),
    MPUInt256("0x077d46cefa8d9df51b3bea3677d46cefb29ed700b937fd286a963948414cf0d1"),
    MPUInt256("0x03aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaf7319430558be9bc98436b60aa30091"),
    MPUInt256("0x029cbc14e5e0a72f05397829cbc14e5e0ddb42eae12333ba81515e8c24133cb9"),
    MPUInt256("0x0d1eb851eb851eb851eb851eb851eb852fd58f7400835cc43dfa98f1c71b7fb3"),
    MPUInt256("0x00a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a17227ea9cfaa6c726974f2e35d771b9"),
    MPUInt256("0x05d89d89d89d89d89d89d89d89d89d89e03dc79b31b316d82a06b7e72bcff9be"),
    MPUInt256("0x0a90e7d95bc609a90e7d95bc609a90e7e724276c61f5a188b7bedc02eb4690c8"),
    MPUInt256("0x0ded097b425ed097b425ed097b425ed0a9de842554f3f58b26baab96f21854e6"),
    MPUInt256("0x061bed61bed61bed61bed61bed61bed623e56d5e50d78faa46dd212f4d62841e"),
    MPUInt256("0x0c492492492492492492492492492492592b36b8aad98f492832b0ab19aa7996"),
    MPUInt256("0x031674c59d31674c59d31674c59d31675060ecda1f73273fd21e7eea23e794b0"),
    MPUInt256("0x0a34f72c234f72c234f72c234f72c235047c969270ca190452aaa05306563355"),
    MPUInt256("0x02b63cbeea4e1a08ad8f2fba9386822b675585782cfa3d4b615e3c2fdbb02c99"),
    MPUInt256("0x02eeeeeeeeeeeeeeeeeeeeeeeeeeeeeef2c27a9c0446fee3079cf891a21c0074"),
    MPUInt256("0x068eb04325c53ef368eb04325c53ef36973e01af2dce660c4e0feddca400071e"),
    MPUInt256("0x0a1084210842108421084210842108421da50887eaa403b01ea03614b65891b2"),
    MPUInt256("0x075d75d75d75d75d75d75d75d75d75d767114e72ac8a5c832c9abfe79060e7a6"),
    MPUInt256("0x06c0000000000000000000000000000008ce1169ecc0762a6d27c1cf1f37b568"),
    MPUInt256("0x017a17a17a17a17a17a17a17a17a17a17c04d41c6d90f2e8766818e6dd4203cf"),
    MPUInt256("0x0fc1f07c1f07c1f07c1f07c1f07c1f07d67e81b85aae0af2206f330e53cb50b7"),
    MPUInt256("0x0c6afc2dd9ca81e9131abf0b7672a07a54f97954e9779478817d139a31390f77"),
    MPUInt256("0x047878787878787878787878787878787e4d5c679e79e44af2f614293f9f0a46"),
    MPUInt256("0x076b981dae6076b981dae6076b981dae6a24a0674072d5b8bd402df5f72b83ad"),
    MPUInt256("0x003a83a83a83a83a83a83a83a83a83a83acffc415a197aed1e83eb790ff4e21d"),
    MPUInt256("0x0ea5dbf193d4bb7e327a976fc64f52ee0be55f58712396cb7114705ca46dac62"),
    MPUInt256("0x0271c71c71c71c71c71c71c71c71c71c74f7662cae3b29bd3102cf24071755b6"),
    MPUInt256("0x08fc7e3f1f8fc7e3f1f8fc7e3f1f8fc7efaad279891e5b97f2577a4a6c51f546"),
    MPUInt256("0x0b759f22983759f22983759f2298375a011c3d56ceaa6cdeb4b339242dd2a915"),
    MPUInt256("0x08bf258bf258bf258bf258bf258bf258ca8e5fa2ab023dd82951bb4bda125522"),
    MPUInt256("0x0250d79435e50d79435e50d79435e50d7c48b1a397965d6fdd96df2f9aedaf84"),
    MPUInt256("0x08ef606a63bd81a98ef606a63bd81a98fb0827cc1f29dc924bc7c64de41ee410"),
    MPUInt256("0x0e906906906906906906906906906906a36880fbe31c77c9ac10bcabb083de72"),
    MPUInt256("0x0067b23a5440cf6474a8819ec8e951033e19168741b203f876e34d0a639190b5"),
    MPUInt256("0x023333333333333333333333333333333611dbf503353f2a45b5ba6d39950057"),
    MPUInt256("0x0948b0fcd6e9e06522c3f35ba781948b1be9ad6e38a2a3b219d1c7b9f6bae344"),
    MPUInt256("0x0f063e7063e7063e7063e7063e7063e719d79fb4f6b051b68ae58f02e6e6d69d"),
    MPUInt256("0x02e43dafcea68de12818acb90f6bf3a9a73de322111d53dcb678871d706a1d0c"),
    MPUInt256("0x0d86186186186186186186186186186197bc77c552e393cd8d7d417adac397b3"),
    MPUInt256("0x06c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6cf9daf1905c63c66d3fbbd8cabe39901"),
    MPUInt256("0x08be82fa0be82fa0be82fa0be82fa0be8e620b888ea51733a733b9233eb5f9c6"),
    MPUInt256("0x0178a4c8178a4c8178a4c8178a4c8178a6b3666cbf898710c46b9f2e8fe7863f"),
    MPUInt256("0x07d1745d1745d1745d1745d1745d1745dba722d29b44a100024ecd84279b078e"),
    MPUInt256("0x0da9b536a6d4da9b536a6d4da9b536a6e6ad25e94340bf74e0c7ca8f524219a5"),
    MPUInt256("0x01f49f49f49f49f49f49f49f49f49f49f72c51bd582f54975a68a5b66c12aaf8"),
    MPUInt256("0x0c7bc7bc7bc7bc7bc7bc7bc7bc7bc7bc8c106e8ec2aaafd16ee9c64a050350f4"),
    MPUInt256("0x0990b21642c8590b21642c8590b21642d4d336c51914078023f4bb3f109e17bd"),
    MPUInt256("0x016058160581605816058160581605816223b265bb7023834c64adafafe91a7d"),
    MPUInt256("0x0bbea3677d46cefa8d9df51b3bea3677e3bee86fae17ccff61544e314f21625f"),
    MPUInt256("0x01da46102b1da46102b1da46102b1da4636d5ae94611e4597e124c26158af2d0"),
    MPUInt256("0x09d5555555555555555555555555555562290990d4282db910cb4ce833cc6a3f"),
    MPUInt256("0x0d07eae2f8151d07eae2f8151d07eae309149bff3830977c6cad535a16ed28a4"),
    MPUInt256("0x094e5e0a72f05397829cbc14e5e0a72f115d1e64c20d68486cb1e0d340848853"),
    MPUInt256("0x0a814afd6a052bf5a814afd6a052bf5a8eff012591c95ca16af4ccb437dce07a"),

};

// -y / (x - y)
static const CSC25519 MPLagrangeCoeff(uint32_t x,uint32_t y)
{
    return (x > y ? -SCInverse[x - y].ToSC25519() * y : SCInverse[y - x].ToSC25519() * y);
}

